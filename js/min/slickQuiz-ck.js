/*!
 * SlickQuiz jQuery Plugin
 * http://github.com/jewlofthelotus/SlickQuiz
 *
 * @updated October 25, 2014
 * @version 1.5.20
 *
 * @author Julie Cameron - http://www.juliecameron.com
 * @copyright (c) 2013 Quicken Loans - http://www.quickenloans.com
 * @license MIT
 */(function(e){e.slickQuiz=function(t,n){var r=this,s=e(t),o="#"+s.attr("id"),u={checkAnswerText:"Show Answer",nextQuestionText:"Next Question",backButtonText:"",completeQuizText:"",tryAgainText:"",questionCountText:"%current",preventUnansweredText:"You must select at least one answer.",questionTemplateText:"%count. %text",scoreTemplateText:"%score / %total",nameTemplateText:"<span>Quiz: </span>%name",skipStartButton:!1,numberOfQuestions:null,randomSortQuestions:!1,randomSortAnswers:!1,preventUnanswered:!1,disableScore:!1,disableRanking:!1,scoreAsPercentage:!1,perQuestionResponseMessaging:!0,perQuestionResponseAnswers:!1,completionResponseMessaging:!1,displayQuestionCount:!0,displayQuestionNumber:!0,animationCallbacks:{setupQuiz:function(){},startQuiz:function(){},resetQuiz:function(){},checkAnswer:function(){},nextQuestion:function(){},backToQuestion:function(){},completeQuiz:function(){}},events:{onStartQuiz:function(e){},onCompleteQuiz:function(e){}}},a="questionCount",f="questions",l="question",c="answers",h="responses",p="complete",d="correctResponse",v="incorrectResponse",m="correct",g="incorrect",y="checkAnswer",b="nextQuestion",w="lastQuestion",E="backToQuestion",S="tryAgain",x="."+a,T="."+f,N="."+l,C="."+c,k="."+c+" li",L="."+h,A="."+h+" li",O="."+d,M="."+m,_="."+g,D="."+y,P="."+b,H="."+E,B="."+S,j=o+" .startQuiz",F=o+" .quizName",I=o+" .quizArea",q=o+" .quizResults",R=o+" .quizResultsCopy",U=o+" .quizHeader",z=o+" .quizScore",W=o+" .quizLevel",X=e(j),V=e(F),J=e(I),K=e(q),Q=e(R),G=e(U),Y=e(z),Z=e(W),et="";if(n&&typeof n.disableNext!="undefined"){typeof n.preventUnanswered=="undefined"&&(n.preventUnanswered=n.disableNext);et+="The 'disableNext' option has been deprecated, please use 'preventUnanswered' in it's place.\n\n"}if(n&&typeof n.disableResponseMessaging!="undefined"){typeof n.preventUnanswered=="undefined"&&(n.perQuestionResponseMessaging=n.disableResponseMessaging);et+="The 'disableResponseMessaging' option has been deprecated, please use 'perQuestionResponseMessaging' and 'completionResponseMessaging' in it's place.\n\n"}if(n&&typeof n.randomSort!="undefined"){typeof n.randomSortQuestions=="undefined"&&(n.randomSortQuestions=n.randomSort);typeof n.randomSortAnswers=="undefined"&&(n.randomSortAnswers=n.randomSort);et+="The 'randomSort' option has been deprecated, please use 'randomSortQuestions' and 'randomSortAnswers' in it's place.\n\n"}et!==""&&(typeof console!="undefined"?console.warn(et):alert(et));r.config=e.extend(u,n);var tt=r.config.json?r.config.json:typeof quizJSON!="undefined"?quizJSON:null,nt=r.config.randomSortQuestions?tt.questions.sort(function(){return Math.round(Math.random())-.5}):tt.questions,rt=nt.length;if(r.config.numberOfQuestions&&rt>=r.config.numberOfQuestions){nt=nt.slice(0,r.config.numberOfQuestions);rt=nt.length}var it={method:{getKey:function(t){var n=[];for(i=0;i<t;i++)n[i]=e.Deferred();return n},turnKeyAndGo:function(t,n){e.when.apply(null,t).then(function(){n()})},getKeyNotch:function(e,t){return function(){e[t-1].resolve()}}}};r.method={setupQuiz:function(t){var n,o,u;n=it.method.getKey(3);o=it.method.getKeyNotch;u=o;V.hide().html(r.config.nameTemplateText.replace("%name",tt.info.name)).fadeIn(1e3,u(n,1));G.hide().prepend(e('<div class="quizDescription">'+tt.info.main+"</div>")).fadeIn(1e3,u(n,2));Q.append(tt.info.results);r.config.tryAgainText&&r.config.tryAgainText!==""&&Q.append('<p><a class="button button-primary button-small allports '+S+'" href="#">'+r.config.tryAgainText+"</a></p>");var p=e('<ol class="'+f+'"></ol>'),d=1;for(i in nt)if(nt.hasOwnProperty(i)){var v=nt[i],x=e('<li class="'+l+'" id="question'+(d-1)+'"></li>');r.config.displayQuestionCount&&x.append('<div class="'+a+'">'+r.config.questionCountText.replace("%current",'<span class="current">'+d+"</span>").replace("%total",'<span class="total">'+rt+"</span>")+"</div>");var T="";r.config.displayQuestionNumber?T=r.config.questionTemplateText.replace("%count",d).replace("%text",v.q):T=v.q;x.append("<h2>"+T+"</h2>");var N=0;for(i in v.a)if(v.a.hasOwnProperty(i)){answer=v.a[i];answer.correct&&N++}var C=e('<ul class="'+c+'"></ul>'),k=r.config.randomSortAnswers?v.a.sort(function(){return Math.round(Math.random())-.5}):v.a,L=v.select_any?v.select_any:!1,A=v.force_checkbox?v.force_checkbox:!1,O=N>1&&!L||A,M=s.attr("id")+"_question"+(d-1),_=O?"checkbox":"radio";d==tt.questions.length&&(b=b+" "+w);for(i in k)if(k.hasOwnProperty(i)){answer=k[i],optionId=M+"_"+i.toString();var D='<input id="'+optionId+'" name="'+M+'" type="'+_+'" /> ',P='<label for="'+optionId+'">'+answer.option+"</label>",H=e("<li></li>").append(D).append(P);C.append(H)}x.append(C);if(r.config.perQuestionResponseMessaging||r.config.completionResponseMessaging){var B=e('<ul class="'+h+'"></ul>');B.append('<li class="'+m+'">'+v.correct+"</li>");B.append('<li class="'+g+'">'+v.incorrect+"</li>");x.append(B)}r.config.backButtonText&&r.config.backButtonText!==""&&x.append('<a href="#" class="button button-primary allports '+E+'">'+r.config.backButtonText+"</a>");var j=r.config.nextQuestionText;r.config.completeQuizText&&d==rt&&(j=r.config.completeQuizText);if(!r.config.perQuestionResponseMessaging)x.append('<div class="u-center quizNav"><a href="#" class="button button-primary allports '+b+" "+y+'">'+j+"</a></div>");else{x.append('<div class="u-center quizNav"><a href="#" class="button button-primary allports '+b+'">'+j+"</a></div>");x.append('<div class="u-center quizNav"><a href="#" class="button button-primary allports '+y+'">'+r.config.checkAnswerText+"</a></div>")}p.append(x);d++}J.append(p);if(r.config.skipStartButton||X.length==0){X.hide();r.method.startQuiz.apply(this,[{callback:r.config.animationCallbacks.startQuiz}]);u(n,3).apply(null,[])}else X.fadeIn(500,u(n,3));it.method.turnKeyAndGo(n,t&&t.callback?t.callback:function(){})},startQuiz:function(t){function u(t){var n=e(o+" "+T+" li").first();n.length&&n.fadeIn(500,function(){t&&t.callback&&t.callback()})}var n,i,s;n=it.method.getKey(1);i=it.method.getKeyNotch;s=i;r.config.skipStartButton||X.length==0?u({callback:s(n,1)}):X.fadeOut(300,function(){u({callback:s(n,1)})});it.method.turnKeyAndGo(n,t&&t.callback?t.callback:function(){});r.config.events&&r.config.events.onStartQuiz&&r.config.events.onStartQuiz.apply(null,[])},resetQuiz:function(t,n){var i,s,u;i=it.method.getKey(1);s=it.method.getKeyNotch;u=s;K.fadeOut(300,function(){e(o+" input").prop("checked",!1).prop("disabled",!1);Z.attr("class","quizLevel");e(o+" "+N).removeClass(d).removeClass(v).remove(p);e(o+" "+k).removeClass(m).removeClass(g);e(o+" "+N+","+o+" "+L+","+o+" "+A+","+o+" "+P+","+o+" "+H).hide();e(o+" "+x+","+o+" "+C+","+o+" "+D).show();J.append(e(o+" "+T)).show();u(i,1).apply(null,[]);r.method.startQuiz({callback:r.config.animationCallbacks.startQuiz},K)});it.method.turnKeyAndGo(i,n&&n.callback?n.callback:function(){})},checkAnswer:function(t,n){var s,o,u;s=it.method.getKey(2);o=it.method.getKeyNotch;u=o;var a=e(e(t).parents(N)[0]),f=a.find(C+" li"),l=f.find("input:checked"),c=parseInt(a.attr("id").replace(/(question)/,""),10),h=nt[c].a,y=nt[c].select_any?nt[c].select_any:!1;f.addClass(g);var b=[];for(i in h)if(h.hasOwnProperty(i)){var w=h[i],E=parseInt(i,10);if(w.correct){b.push(E);f.eq(E).removeClass(g).addClass(m)}}var S=[];l.each(function(){var t=e(this).attr("id");S.push(parseInt(t.replace(/(.*\_question\d{1,}_)/,""),10))});if(r.config.preventUnanswered&&S.length===0){alert(r.config.preventUnansweredText);return!1}var x=r.method.compareAnswers(b,S,y);x?a.addClass(d):a.addClass(v);a.find(x?M:_).show();if(r.config.perQuestionResponseMessaging){e(t).hide();r.config.perQuestionResponseAnswers?a.addClass(p):a.find(C).hide({duration:0,complete:function(){a.addClass(p)}});a.find("input").prop("disabled",!0);a.find(L).show();a.find(P).fadeIn(300,u(s,1));a.find(H).fadeIn(300,u(s,2));a.find(H).length||u(s,2).apply(null,[])}else{u(s,1).apply(null,[]);u(s,2).apply(null,[])}it.method.turnKeyAndGo(s,n&&n.callback?n.callback:function(){})},nextQuestion:function(t,n){var i,s,o;i=it.method.getKey(1);s=it.method.getKeyNotch;o=s;var u=e(e(t).parents(N)[0]),a=u.next(N),f=u.find("input:checked");if(r.config.preventUnanswered&&f.length===0)return!1;if(a.length)u.fadeOut(300,function(){a.find(H).show().end().fadeIn(500,o(i,1));a.find(H).show().end().length||o(i,1).apply(null,[])});else{o(i,1).apply(null,[]);r.method.completeQuiz({callback:r.config.animationCallbacks.completeQuiz})}it.method.turnKeyAndGo(i,n&&n.callback?n.callback:function(){})},backToQuestion:function(t,n){var r,i,s;r=it.method.getKey(2);i=it.method.getKeyNotch;s=i;var o=e(e(t).parents(N)[0]),u=o.find(L);if(u.css("display")==="block")o.find(L).fadeOut(300,function(){o.removeClass(d).removeClass(v).removeClass(p);o.find(L+", "+A).hide();o.find(C).show();o.find(k).removeClass(m).removeClass(g);o.find("input").prop("disabled",!1);o.find(C).fadeIn(500,s(r,1));o.find(D).fadeIn(500,s(r,2));o.find(P).hide();o.attr("id")!="question0"?o.find(H).show():o.find(H).hide()});else{var a=o.prev(N);o.fadeOut(300,function(){a.removeClass(d).removeClass(v).removeClass(p);a.find(L+", "+A).hide();a.find(C).show();a.find(k).removeClass(m).removeClass(g);a.find("input").prop("disabled",!1);a.find(P).hide();a.find(D).show();a.attr("id")!="question0"?a.find(H).show():a.find(H).hide();a.fadeIn(500,s(r,1));s(r,2).apply(null,[])})}it.method.turnKeyAndGo(r,n&&n.callback?n.callback:function(){})},completeQuiz:function(t){var n,i,s;n=it.method.getKey(1);i=it.method.getKeyNotch;s=i;var u=e(o+" "+O).length,a=u;r.config.scoreAsPercentage&&(a=(u/rt).toFixed(2)*100+"%");r.config.disableScore?e(z).remove():e(z+" span").html(r.config.scoreTemplateText.replace("%score",a).replace("%total",rt));if(r.config.disableRanking)e(W).remove();else{var f=[tt.info.level1,tt.info.level2,tt.info.level3,tt.info.level4,tt.info.level5],l=r.method.calculateLevel(u),c=e.isNumeric(l)?f[l]:"";e(W+" span").html(c);e(W).addClass("level"+l)}J.fadeOut(300,function(){if(r.config.completionResponseMessaging){e(o+" .button:not("+B+"), "+o+" "+x).hide();e(o+" "+N+", "+o+" "+C+", "+o+" "+L).show();K.append(e(o+" "+T)).fadeIn(500,s(n,1))}else K.fadeIn(500,s(n,1))});it.method.turnKeyAndGo(n,t&&t.callback?t.callback:function(){});r.config.events&&r.config.events.onCompleteQuiz&&r.config.events.onCompleteQuiz.apply(null,[{questionCount:rt,score:u}])},compareAnswers:function(t,n,r){return r?e.inArray(n[0],t)>-1:e(t).not(n).length===0&&e(n).not(t).length===0},calculateLevel:function(e){var t=(e/rt).toFixed(2),n=null;r.method.inRange(0,.2,t)?n=4:r.method.inRange(.21,.4,t)?n=3:r.method.inRange(.41,.6,t)?n=2:r.method.inRange(.61,.8,t)?n=1:r.method.inRange(.81,1,t)&&(n=0);return n},inRange:function(e,t,n){return n>=e&&n<=t}};r.init=function(){r.method.setupQuiz.apply(null,[{callback:r.config.animationCallbacks.setupQuiz}]);X.on("click",function(t){t.preventDefault();!this.disabled&&!e(this).hasClass("disabled")&&r.method.startQuiz.apply(null,[{callback:r.config.animationCallbacks.startQuiz}])});e(o+" "+B).on("click",function(e){e.preventDefault();r.method.resetQuiz(this,{callback:r.config.animationCallbacks.resetQuiz})});e(o+" "+D).on("click",function(e){e.preventDefault();r.method.checkAnswer(this,{callback:r.config.animationCallbacks.checkAnswer})});e(o+" "+H).on("click",function(e){e.preventDefault();r.method.backToQuestion(this,{callback:r.config.animationCallbacks.backToQuestion})});e(o+" "+P).on("click",function(e){e.preventDefault();r.method.nextQuestion(this,{callback:r.config.animationCallbacks.nextQuestion})});var t=s.attr("id")+"-name";V.attr("id",t);s.attr({"aria-labelledby":t,"aria-live":"polite","aria-relevant":"additions",role:"form"});e(j+', [href = "#"]').attr("role","button")};r.init()};e.fn.slickQuiz=function(t){return this.each(function(){if(undefined===e(this).data("slickQuiz")){var n=new e.slickQuiz(this,t);e(this).data("slickQuiz",n)}})}})(jQuery);